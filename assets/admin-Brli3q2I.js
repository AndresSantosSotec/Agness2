import{r as i,s as q,w as H}from"./chunk-NL6KNZEE-igR-ERF4.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{u as z}from"./authStore-Du5Ti9MW.js";import{i as W}from"./index-9DermFXF.js";import{a as b}from"./client-DVUqMjJO.js";import{y as x,L as G,P as J}from"./PrivateRoute-qKyg2_uq.js";const K=()=>{var u;const[t,S]=i.useState(!0),[N,I]=i.useState([]),[T,v]=i.useState([]),[_,R]=i.useState(!1),[h,P]=i.useState(null),[E,D]=i.useState(""),[U,w]=i.useState({});q();const k=z(r=>r.user),L=z(r=>r.token);i.useEffect(()=>{(async()=>{S(!0);try{if(!k||!L)throw new Error("No hay sesi√≥n activa");const c=k.user||k}catch(c){console.error("Error:",c),z.getState().logout()}finally{S(!1)}})(),y(),F()},[k,L]);const y=async()=>{try{const r=await b.get("/api/users");console.log("Usuarios obtenidos:",r.data),I(r.data)}catch(r){x.error("Error al obtener usuarios"),console.error("Error al obtener turnos:",r)}},F=async()=>{try{const r=await b.get("/api/roles");console.log("Roles obtenidos:",r.data),v(r.data)}catch(r){x.error("Error al obtener roles"),console.error("Error al obtener roles:",r)}},$=async r=>{try{w({});const c=h?await b.put(`/api/users/${h.id}`,r):await b.post("/api/users",r);console.log("Usuario guardado:",c.data),x.success(`Usuario ${h?"actualizado":"creado"} correctamente`),R(!1),await y()}catch(c){if(console.error("Error al guardar el usuario:",c),c.response&&c.response.status===422){const d=c.response.data.errors;w(d),console.log("Errores de validaci√≥n:",d)}else x.error("Error al guardar el usuario. Por favor, int√©ntelo de nuevo.")}},p=async r=>{r.preventDefault();const c=r.target,d=new FormData(c),C={name:d.get("name"),email:d.get("email"),rol_id:d.get("rol_id"),...h?{}:{password:d.get("password"),password_confirmation:d.get("confirmPassword")}};h?d.get("password")&&(C.password=d.get("password"),C.password_confirmation=d.get("confirmPassword")):(C.password=d.get("password"),C.password_confirmation=d.get("confirmPassword")),await $(C)},V=()=>{P(null),w({}),R(!0)},g=r=>{P(r),w({}),R(!0)},O=async r=>{const c=x.info(e.jsxs("div",{children:[e.jsx("p",{children:"¬øEst√° seguro que desea eliminar este usuario?"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"15px"},children:[e.jsx("button",{onClick:async()=>{x.dismiss(c);try{await b.delete(`/api/users/${r}`),await y(),x.success("Usuario eliminado correctamente")}catch(d){console.error("Error al eliminar usuario:",d),x.error("No se pudo eliminar el usuario")}},style:{backgroundColor:"#d33",color:"white",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer"},children:"Eliminar"}),e.jsx("button",{onClick:()=>x.dismiss(c),style:{backgroundColor:"#555",color:"white",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer"},children:"Cancelar"})]})]}),{position:"top-center",autoClose:!1,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!0,draggable:!0,closeButton:!1})},A=N.filter(r=>r.name.toLowerCase().includes(E.toLowerCase())||r.email.toLowerCase().includes(E.toLowerCase())),a=r=>{var c;return((c=U[r])==null?void 0:c.at(0))||""};return e.jsxs("div",{className:"user-management",children:[e.jsxs("div",{className:"user-actions",children:[e.jsx("div",{className:"search-container",children:e.jsx("input",{type:"text",placeholder:"Buscar usuarios...",value:E,onChange:r=>D(r.target.value),className:"search-input"})}),e.jsx("button",{className:"add-user-btn",onClick:V,children:"+ Agregar Usuario"})]}),e.jsx("div",{className:"users-table-container",children:t?e.jsx("p",{children:"Cargando usuarios..."}):e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Rol"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:A.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,style:{textAlign:"center"},children:"No se encontraron usuarios"})}):A.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.name}),e.jsx("td",{children:r.email}),e.jsx("td",{children:e.jsx("span",{className:"role-badge",children:r.rol.nombre})}),e.jsxs("td",{className:"action-buttons",children:[e.jsx("button",{className:"edit-btn",onClick:()=>g(r),children:"Editar"}),e.jsx("button",{className:"delete-btn",onClick:()=>O(r.id),children:"Eliminar"})]})]},r.id))})]})}),_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h2",{children:h?"Editar Usuario":"Agregar Nuevo Usuario"}),e.jsxs("form",{className:"user-form",onSubmit:p,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre"}),e.jsx("input",{name:"name",type:"text",placeholder:"Nombre completo",defaultValue:(h==null?void 0:h.name)||""}),a("name")&&e.jsx("p",{className:"error-message",style:{color:"red",fontSize:"0.8rem",marginTop:"4px"},children:a("name")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{name:"email",type:"email",placeholder:"correo@ejemplo.com",defaultValue:(h==null?void 0:h.email)||""}),a("email")&&e.jsx("p",{className:"error-message",style:{color:"red",fontSize:"0.8rem",marginTop:"4px"},children:a("email")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Rol"}),e.jsxs("select",{name:"rol_id",defaultValue:h?h.rol.id:"",required:!0,children:[e.jsx("option",{value:"",children:"Seleccione un rol"}),T.map(r=>e.jsx("option",{value:r.id,children:r.nombre},r.id))]}),a("rol_id")&&e.jsx("p",{className:"error-message",style:{color:"red",fontSize:"0.8rem",marginTop:"4px"},children:a("rol_id")})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Contrase√±a",h&&e.jsx("span",{style:{fontSize:"0.8rem",marginLeft:"5px",color:"#777"},children:"(Dejar en blanco para mantener la actual)"})]}),e.jsx("input",{type:"password",name:"password",placeholder:"Contrase√±a",required:!h}),a("password")&&e.jsx("p",{className:"error-message",style:{color:"red",fontSize:"0.8rem",marginTop:"4px"},children:a("password")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Confirmar Contrase√±a"}),e.jsx("input",{type:"password",name:"confirmPassword",placeholder:"Confirmar contrase√±a",required:!h||!!((u=document.querySelector('input[name="password"]'))!=null&&u.value)})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>R(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"save-btn",children:"Guardar"})]})]})]})})]})},X=()=>{const[t,S]=i.useState([]),[N,I]=i.useState(!1),[T,v]=i.useState(!1),[_,R]=i.useState(""),[h,P]=i.useState(""),[E,D]=i.useState(""),[U,w]=i.useState(null),[k,L]=i.useState(null),[y,F]=i.useState(!1),[$,p]=i.useState(null),V=i.useRef(null);i.useEffect(()=>{g()},[]);const g=async()=>{try{const s=await b.get("/api/videos/all");S(s.data)}catch(s){console.error("Error al listar videos:",s)}},O=s=>{const o=Math.floor(s/60),l=Math.floor(s%60),m=M=>M.toString().padStart(2,"0");return`${m(o)}:${m(l)}`},A=s=>new Promise((o,l)=>{const m=URL.createObjectURL(s),M=document.createElement("video");M.preload="metadata",M.src=m,M.onloadedmetadata=()=>{URL.revokeObjectURL(m);const B=M.duration;o(O(B))},M.onerror=()=>{URL.revokeObjectURL(m),l(new Error("No se pudo leer la duraci√≥n del video."))}}),a=s=>{s.preventDefault(),I(!0)},u=()=>{I(!1)},r=async s=>{s.preventDefault(),I(!1);const o=s.dataTransfer.files;if(o&&o.length>0){const l=o[0];if(!l.type.startsWith("video/")){alert("Por favor, suelta un archivo de video v√°lido (MP4, AVI, MOV...).");return}w(l);try{const m=await A(l);D(m)}catch(m){console.warn("No se pudo extraer la duraci√≥n autom√°ticamente.",m),D("")}v(!0)}},c=()=>{var s;(s=V.current)==null||s.click()},d=async s=>{if(s.target.files&&s.target.files.length>0){const o=s.target.files[0];if(!o.type.startsWith("video/")){alert("Selecciona √∫nicamente archivos de video (MP4, AVI, MOV)."),s.target.value="";return}w(o);try{const l=await A(o);D(l)}catch(l){console.warn("No se pudo extraer la duraci√≥n autom√°ticamente.",l),D("")}v(!0)}},C=s=>{if(s.target.files&&s.target.files.length>0){const o=s.target.files[0];if(!o.type.startsWith("image/")){alert("Selecciona √∫nicamente un archivo de imagen (JPEG, PNG, GIF)."),s.target.value="";return}L(o)}},n=async s=>{try{await b.patch(`/api/videos/${s}/toggle-status`),g()}catch(o){console.error("Error al cambiar status:",o)}},j=async s=>{if(window.confirm("¬øSeguro que deseas eliminar este video?"))try{await b.delete(`/api/videos/${s}`),g()}catch(o){console.error("Error al eliminar video:",o)}},f=async()=>{var o;if(p(null),!U){p("Debes seleccionar primero un archivo de video.");return}F(!0);const s=new FormData;s.append("name",_),s.append("description",h),s.append("duration",E||"00:00"),s.append("video_file",U),k&&s.append("thumbnail",k),console.group("üì§ Datos a enviar en FormData");for(let l of s.entries())if(l[1]instanceof File){const m=l[1];console.log(`${l[0]}: File { name: ${m.name}, size: ${m.size}, type: ${m.type} }`)}else console.log(`${l[0]}: ${l[1]}`);console.groupEnd();try{const l=await b.post("/api/videos",s,{headers:{"Content-Type":"multipart/form-data"}});console.log("‚úÖ Respuesta del servidor:",l.data),await g(),R(""),P(""),D(""),w(null),L(null),v(!1)}catch(l){if(console.error("‚ùå Error al subir video: ",l),((o=l.response)==null?void 0:o.status)===422){console.group("üö® Errores de validaci√≥n (422)"),console.log("C√≥digo:",l.response.status),console.log("Respuesta completa:",l.response.data),l.response.data.errors&&(console.log("Detalles en err.response.data.errors:"),console.dir(l.response.data.errors)),console.groupEnd();const m=l.response.data.errors;m!=null&&m.video_file?p(m.video_file.join(" ")):m!=null&&m.thumbnail?p(m.thumbnail.join(" ")):m!=null&&m.name?p(m.name.join(" ")):p("Error de validaci√≥n. Revisa los campos del formulario.")}else p("Error inesperado al subir el video.")}finally{F(!1)}};return e.jsxs("div",{className:"video-upload__container",children:[e.jsxs("div",{className:`drop-zone ${N?"active":""}`,onDragOver:a,onDragLeave:u,onDrop:r,children:[e.jsx("div",{className:"drop-icon",children:"üìÅ"}),e.jsx("p",{children:"Arrastra y suelta un video aqu√≠"}),e.jsx("span",{children:"- o -"}),e.jsx("button",{type:"button",className:"browse-btn",onClick:c,children:"Seleccionar Archivos"}),e.jsx("input",{ref:V,type:"file",accept:"video/*",onChange:d,style:{display:"none"}}),e.jsx("p",{className:"supported-formats",children:"Formatos soportados: MP4, AVI, MOV (M√°x. 100MB)"})]}),T&&e.jsxs("div",{className:"video-upload__form",children:[e.jsx("h3",{children:"Informaci√≥n del Video"}),$&&e.jsx("p",{className:"error-text",children:$}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre"}),e.jsx("input",{type:"text",value:_,onChange:s=>R(s.target.value),placeholder:"Ej: Instrucciones de uso",disabled:y})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descripci√≥n"}),e.jsx("textarea",{value:h,onChange:s=>P(s.target.value),placeholder:"Descripci√≥n breve del video",disabled:y})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Duraci√≥n (MM:SS)"}),e.jsx("input",{type:"text",value:E,readOnly:!0,placeholder:"Se calcula autom√°ticamente",disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Thumbnail (opcional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:C,disabled:y})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>{v(!1),w(null),L(null),p(null),D("")},disabled:y,children:"Cancelar"}),e.jsx("button",{type:"button",className:"upload-btn",onClick:f,disabled:y,children:y?"Subiendo...":"Subir Video"})]})]}),e.jsxs("div",{className:"video-upload__gallery",children:[e.jsx("h3",{className:"video-upload__gallery-title",children:"Videos Disponibles"}),e.jsxs("div",{className:"video-upload__grid",children:[t.length===0&&e.jsx("p",{className:"video-upload__no-videos",children:"No hay videos disponibles."}),t.map(s=>e.jsxs("div",{className:`video-upload__card ${s.status==="inactive"?"inactive":""}`,children:[e.jsxs("div",{className:"video-upload__thumbnail",children:[e.jsx("img",{src:s.thumbnail_url?s.thumbnail_url:"https://via.placeholder.com/150?text=Sin+Thumbnail",alt:s.name}),e.jsx("span",{className:"video-upload__duration",children:s.duration})]}),e.jsxs("div",{className:"video-upload__info",children:[e.jsx("h4",{children:s.name}),e.jsx("p",{className:"video-upload__description",children:s.description}),e.jsx("div",{className:"video-upload__meta",children:e.jsxs("span",{className:"video-upload__date",children:["Subido: ",new Date(s.created_at).toLocaleDateString()]})}),e.jsxs("div",{className:"video-upload__actions",children:[e.jsx("button",{className:`video-upload__btn-toggle ${s.status==="active"?"active":"inactive"}`,onClick:()=>n(s.id),children:s.status==="active"?"Desactivar":"Activar"}),e.jsx("button",{className:"video-upload__btn-delete",onClick:()=>j(s.id),children:"Eliminar"})]}),e.jsx("video",{src:s.file_url,controls:!0,className:"video-upload__player"})]})]},s.id))]})]})]})},Q=()=>{const[t,S]=i.useState({start:new Date().toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[N,I]=i.useState({start:new Date().toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[T,v]=i.useState(!1),[_,R]=i.useState({}),[h,P]=i.useState([]),[E,D]=i.useState(null),[U,w]=i.useState([]),[k,L]=i.useState([]);z(a=>a.user),z(a=>a.token);const y=[{id:"daily-summary",name:"Resumen Diario",description:"Informe detallado de actividad diaria, turnos y tiempos de atenci√≥n.",format:["PDF","Excel","Ver"],icon:"üìä"},{id:"user-activity",name:"Actividad de Usuarios",description:"Detalles sobre el uso del sistema por operadores y administradores.",format:["PDF","Excel","Ver"],icon:"üë•"},{id:"peak-hours",name:"Horas Pico",description:"Identificaci√≥n de las horas con mayor demanda de servicios.",format:["PDF","Excel"],icon:"üìà"}];i.useEffect(()=>{g("view"),F();const a={};y.forEach(u=>{a[u.id]=u.format[0]}),R(a)},[]);const F=async()=>{try{const a=await b.get("/api/users");P(a.data)}catch{x.error("No se pudieron cargar los usuarios")}},$=a=>{S({...t,[a.target.name]:a.target.value})},p=a=>{I({...N,[a.target.name]:a.target.value})},V=a=>{const u=a.target.value;D(u?parseInt(u):null)},g=async a=>{try{if(v(!0),new Date(t.start)>new Date(t.end)){x.error("La fecha de inicio no puede ser posterior a la fecha de fin");return}const u="daily-summary",r=x.info("Generando reporte...",{autoClose:!1}),c={report_type:u,format:a.toLowerCase(),start_date:t.start,end_date:t.end},d=await b.post("/api/reports/generate",c,{responseType:a.toLowerCase()==="view"?"json":"blob"});if(a.toLowerCase()==="view"){w(d.data.data),x.dismiss(r),x.success("Datos cargados correctamente"),v(!1);return}const C=`Reporte_${t.start}_${t.end}`;A(a,d,C)}catch{x.error("Error al generar el reporte. Int√©ntelo de nuevo m√°s tarde.")}finally{v(!1)}},O=async a=>{try{if(v(!0),new Date(N.start)>new Date(N.end)){x.error("La fecha de inicio no puede ser posterior a la fecha de fin");return}if(!E){x.error("Seleccione un usuario");return}const u="summary-user",r=x.info("Generando reporte...",{autoClose:!1}),c={report_type:u,format:a.toLowerCase(),start_date:N.start,end_date:N.end,user_id:E},d=await b.post("/api/reports/generate",c,{responseType:a.toLowerCase()==="view"?"json":"blob"});if(a.toLowerCase()==="view"){L(d.data.data),x.dismiss(r),x.success("Datos cargados correctamente"),v(!1);return}const C=`Reporte_${N.start}_${N.end}`;A(a,d,C)}catch{x.error("Error al generar el reporte. Int√©ntelo de nuevo m√°s tarde.")}finally{v(!1)}},A=async(a="pdf",u,r)=>{try{v(!0);let c="application/pdf",d="pdf";a.toLowerCase()==="excel"&&(c="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",d="xlsx");const C=new Blob([u.data],{type:c}),n=window.URL.createObjectURL(C),j=`${r}.${d}`,f=document.createElement("a");f.href=n,f.setAttribute("download",j),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(n),x.success(`Reporte ${r} generado correctamente`)}catch(c){console.error("Error al descargar el reporte:",c),x.error("No se pudo descargar el reporte")}finally{v(!1),setTimeout(()=>{x.dismiss()},2e3)}};return e.jsxs("div",{className:"reports-container",children:[e.jsxs("div",{className:"report-types",children:[e.jsx("h3",{children:"Informes Disponibles"}),e.jsxs("div",{className:"report-list",children:[e.jsxs("div",{className:"report-item",children:[e.jsxs("div",{className:"report-header",children:[e.jsx("div",{className:"report-icon",children:"üìä"}),e.jsxs("div",{className:"report-title",children:[e.jsx("h4",{children:"Resumen Diario"}),e.jsx("p",{children:"Informe de actividad diaria, turnos y tiempos de atenci√≥n."})]})]}),e.jsx("div",{className:"report-filters",children:e.jsxs("div",{className:"filter-section",children:[e.jsx("h3",{children:"Per√≠odo de Reporte"}),e.jsxs("div",{className:"date-inputs",children:[e.jsxs("div",{className:"date-field",children:[e.jsx("label",{children:"Desde"}),e.jsx("input",{type:"date",name:"start",value:t.start,onChange:$,max:t.end})]}),e.jsxs("div",{className:"date-field",children:[e.jsx("label",{children:"Hasta"}),e.jsx("input",{type:"date",name:"end",value:t.end,onChange:$,min:t.start,max:new Date().toISOString().split("T")[0]})]})]})]})}),e.jsx("div",{className:"report-content",children:e.jsxs("div",{className:"report-formats",children:[e.jsx("button",{className:"format-badge pdf",onClick:()=>g("pdf"),children:"pdf"},"pdf"),e.jsx("button",{className:"format-badge excel",onClick:()=>g("excel"),children:"Excel"},"xlsx"),e.jsx("button",{className:"format-badge view",onClick:()=>g("view"),children:"view"},"view")]})}),e.jsxs("div",{className:"recent-reports",children:[e.jsx("h3",{children:"Visualizacion"}),T?e.jsx("p",{className:"loading-message",children:"Cargando informe..."}):e.jsxs("table",{className:"reports-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No."}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Total Turnos"}),e.jsx("th",{children:"Completados"}),e.jsx("th",{children:"Cancelados"}),e.jsx("th",{children:"Pendientes"}),e.jsx("th",{children:"En proceso"}),e.jsx("th",{children:"Tiempo Promedio (min)"})]})}),e.jsx("tbody",{children:U.map((a,u)=>e.jsxs("tr",{children:[e.jsx("td",{children:u+1}),e.jsx("td",{children:(()=>{const[r,c,d]=a.date.split("-");return`${d}-${c}-${r}`})()}),e.jsx("td",{children:a.total_turnos}),e.jsx("td",{children:a.completados}),e.jsx("td",{children:a.cancelados}),e.jsx("td",{children:a.pendientes}),e.jsx("td",{children:a.en_proceso}),e.jsx("td",{children:a.tiempo_espera_promedio})]},u))})]})]})]},1),e.jsxs("div",{className:"report-item",children:[e.jsxs("div",{className:"report-header",children:[e.jsx("div",{className:"report-icon",children:"üë•"}),e.jsxs("div",{className:"report-title",children:[e.jsx("h4",{children:"Por usuario"}),e.jsx("p",{children:"Informe de turnos atendidos por usuario"})]})]}),e.jsxs("div",{className:"report-filters",children:[e.jsxs("div",{className:"filter-section",children:[e.jsx("h3",{children:"Per√≠odo de Reporte"}),e.jsxs("div",{className:"date-inputs",children:[e.jsxs("div",{className:"date-field",children:[e.jsx("label",{children:"Desde"}),e.jsx("input",{type:"date",name:"start",value:N.start,onChange:p,max:N.end})]}),e.jsxs("div",{className:"date-field",children:[e.jsx("label",{children:"Hasta"}),e.jsx("input",{type:"date",name:"end",value:N.end,onChange:p,min:N.start,max:new Date().toISOString().split("T")[0]})]})]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h3",{children:"Filtrar por Usuario"}),e.jsxs("div",{className:"select-field",children:[e.jsx("label",{children:"Usuario"}),e.jsxs("select",{required:!0,value:E||"",onChange:V,children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccione"}),h.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})]}),e.jsx("div",{className:"report-content",children:e.jsxs("div",{className:"report-formats",children:[e.jsx("button",{className:"format-badge pdf",onClick:()=>O("pdf"),children:"pdf"},"pdf"),e.jsx("button",{className:"format-badge excel",onClick:()=>O("excel"),children:"Excel"},"xlsx"),e.jsx("button",{className:"format-badge view",onClick:()=>O("view"),children:"view"},"view")]})}),e.jsxs("div",{className:"recent-reports",children:[e.jsx("h3",{children:"Visualizacion"}),T?e.jsx("p",{className:"loading-message",children:"Cargando informe..."}):e.jsxs("table",{className:"reports-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No."}),e.jsx("th",{children:"Creacion"}),e.jsx("th",{children:"Ticket"}),e.jsx("th",{children:"Llamada"}),e.jsx("th",{children:"Atencion"}),e.jsx("th",{children:"Cancelacion"}),e.jsx("th",{children:"Estado Final"})]})}),e.jsx("tbody",{children:k.map((a,u)=>e.jsxs("tr",{children:[e.jsx("td",{children:u+1}),e.jsx("td",{children:a.fecha_creacion}),e.jsx("td",{children:a.codigo}),e.jsx("td",{children:a.fecha_llamada}),e.jsx("td",{children:a.fecha_atencion}),e.jsx("td",{children:a.fecha_cancelacion}),e.jsx("td",{children:a.estado})]},u))})]})]})]},2)]})]}),e.jsx(G,{})]})},Y=({data:t})=>e.jsxs("div",{className:"dashboard-container",children:[e.jsxs("div",{className:"stats-row",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon user-icon",children:"üë•"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:"Usuarios Totales"}),e.jsx("p",{className:"stat-value",children:t.totalUsers}),e.jsxs("p",{className:"stat-detail",children:[t.activeUsers," activos"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon video-icon",children:"üé•"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:"Videos Cargados"}),e.jsx("p",{className:"stat-value",children:t.videosUploaded}),e.jsx("p",{className:"stat-detail",children:"√öltimas 24 horas: 2"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon tiempo-icon",children:"‚è±Ô∏è"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:"Tiempo Promedio"}),e.jsx("p",{className:"stat-value",children:t.tiempoPromedio}),e.jsx("p",{className:"stat-detail",children:"min:seg por turno"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon espera-icon",children:"‚åõ"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:"Tiempo de Espera"}),e.jsx("p",{className:"stat-value",children:t.tiempoEspera}),e.jsx("p",{className:"stat-detail",children:"min:seg promedio"})]})]})]}),e.jsxs("div",{className:"activity-section",children:[e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Turnos Atendidos"}),e.jsxs("div",{className:"chart-placeholder",children:[e.jsxs("div",{className:"chart-bar-container",children:[e.jsx("div",{className:"chart-label",children:"Hoy"}),e.jsx("div",{className:"chart-bar",style:{width:`${t.turnos.hoy/t.turnos.mes*100}%`},children:e.jsx("span",{children:t.turnos.hoy})})]}),e.jsxs("div",{className:"chart-bar-container",children:[e.jsx("div",{className:"chart-label",children:"Semana"}),e.jsx("div",{className:"chart-bar",style:{width:`${t.turnos.semana/t.turnos.mes*100}%`},children:e.jsx("span",{children:t.turnos.semana})})]}),e.jsxs("div",{className:"chart-bar-container",children:[e.jsx("div",{className:"chart-label",children:"Mes"}),e.jsx("div",{className:"chart-bar",style:{width:"100%"},children:e.jsx("span",{children:t.turnos.mes})})]})]})]}),e.jsxs("div",{className:"recent-activity",children:[e.jsx("h3",{children:"Actividad Reciente"}),e.jsxs("ul",{className:"activity-list",children:[e.jsxs("li",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üë§"}),e.jsxs("div",{className:"activity-content",children:[e.jsx("p",{children:"Usuario nuevo registrado"}),e.jsx("span",{className:"activity-time",children:"Hace 2 horas"})]})]}),e.jsxs("li",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üé•"}),e.jsxs("div",{className:"activity-content",children:[e.jsx("p",{children:'Nuevo video subido: "Instructivo de pagos"'}),e.jsx("span",{className:"activity-time",children:"Hace 3 horas"})]})]}),e.jsxs("li",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üìä"}),e.jsxs("div",{className:"activity-content",children:[e.jsx("p",{children:"Informe mensual generado"}),e.jsx("span",{className:"activity-time",children:"Hace 1 d√≠a"})]})]})]})]})]})]}),Z=()=>{const[t,S]=i.useState([]),[N,I]=i.useState([]),[T,v]=i.useState([]),[_,R]=i.useState(""),[h,P]=i.useState(""),[E,D]=i.useState(""),[U,w]=i.useState({}),[k,L]=i.useState(null),[y,F]=i.useState(!1),[$,p]=i.useState(null),[V,g]=i.useState(null),[O,A]=i.useState(!0);i.useEffect(()=>{(async()=>{try{const[j,f,s]=await Promise.all([b.get("/api/users"),b.get("/api/tipos-terminal"),b.get("/api/terminales")]);S(j.data),I(f.data),v(s.data)}catch(j){console.error(j),p("Error cargando datos.")}finally{A(!1)}})()},[]);const a=()=>{R(""),P(""),D(""),w({}),L(null)},u=async n=>{var f;n.preventDefault(),L(null),w({}),g(null);const j={};if(_.trim()||(j.nombre="El nombre es requerido."),h===""&&(j.tipo_terminal_id="Selecciona un tipo."),Object.keys(j).length){w(j);return}F(!0);try{const s={nombre:_,tipo_terminal_id:h,usuario_id:E===""?null:E},{data:o}=await b.post("/api/terminales",s,{headers:{"Content-Type":"application/json"}});v(l=>[...l,o]),a(),g("Terminal creada.")}catch(s){if(console.error(s),((f=s.response)==null?void 0:f.status)===422&&s.response.data.errors){const o=s.response.data.errors,l={};o.nombre&&(l.nombre=o.nombre.join(" ")),o.tipo_terminal_id&&(l.tipo_terminal_id=o.tipo_terminal_id.join(" ")),w(l)}else L("Error inesperado.")}finally{F(!1)}},r=async()=>{p(null);try{const{data:n}=await b.get("/api/terminales");v(n)}catch(n){console.error(n),p("No se pudo actualizar.")}},c=async(n,j)=>{if(T.some(f=>{var s;return((s=f.usuario)==null?void 0:s.id)===j&&f.id!==n})){p("Ese usuario ya est√° asignado a otra terminal.");return}p(null),g(null);try{await b.put(`/api/terminales/${n}`,{usuario_id:j}),g(`Terminal ${n} asignada.`),await r()}catch(f){console.error(f),p("No se pudo asignar.")}},d=async n=>{p(null),g(null);try{await b.patch(`/api/terminales/${n}/desasignar`),g(`Terminal ${n} desasignada.`),await r()}catch(j){console.error(j),p("No se pudo desasignar.")}},C=async n=>{if(p(null),g(null),!!window.confirm("¬øEliminar terminal?"))try{await b.delete(`/api/terminales/${n}`),v(j=>j.filter(f=>f.id!==n)),g(`Terminal ${n} eliminada.`)}catch(j){console.error(j),p("No se pudo eliminar.")}};return O?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Cargando‚Ä¶"}):e.jsxs("div",{className:"ventanillas-container",children:[$&&e.jsx("div",{className:"feedback-error",children:$}),V&&e.jsx("div",{className:"feedback-success",children:V}),e.jsxs("section",{className:"ventanillas-card",children:[e.jsx("h1",{children:"Ingreso de Terminales"}),e.jsxs("form",{className:"ventanillas-form",onSubmit:u,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"nombre",children:"Nombre"}),e.jsx("input",{id:"nombre",type:"text",value:_,onChange:n=>R(n.target.value),className:U.nombre?"error-border":"",placeholder:"Ej: Caja 1",disabled:y}),U.nombre&&e.jsx("p",{className:"ventanillas-error-text",children:U.nombre})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"tipo",children:"Tipo"}),e.jsxs("select",{id:"tipo",value:h,onChange:n=>P(n.target.value===""?"":Number(n.target.value)),className:U.tipo_terminal_id?"error-border":"",disabled:y,children:[e.jsx("option",{value:"",children:"Selecciona tipo"}),N.map(n=>e.jsx("option",{value:n.id,children:n.nombre},n.id))]}),U.tipo_terminal_id&&e.jsx("p",{className:"ventanillas-error-text",children:U.tipo_terminal_id})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"usuario",children:"Usuario (opcional)"}),e.jsxs("select",{id:"usuario",value:E,onChange:n=>D(n.target.value===""?"":Number(n.target.value)),disabled:y,children:[e.jsx("option",{value:"",children:"‚Äî"}),t.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"submit",disabled:y,className:"btn btn-green",children:y?"Agregando‚Ä¶":"+ Agregar"})}),k&&e.jsx("div",{className:"ventanillas-error-text mt-2",children:k})]})]}),e.jsxs("section",{className:"ventanillas-card mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{children:"Lista de Terminales"}),e.jsx("button",{onClick:r,className:"btn btn-blue",children:"Refrescar"})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"ventanillas-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center"},children:"No hay terminales."})}):T.map((n,j)=>{var f,s;return e.jsxs("tr",{children:[e.jsx("td",{children:j+1}),e.jsx("td",{children:n.nombre}),e.jsx("td",{children:((f=n.tipo_terminal)==null?void 0:f.nombre)??"‚Äî"}),e.jsx("td",{children:e.jsxs("select",{value:((s=n.usuario)==null?void 0:s.id)??"",onChange:o=>{const l=o.target.value;l?c(n.id,Number(l)):d(n.id)},children:[e.jsx("option",{value:"",children:"‚Äî"}),t.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})}),e.jsxs("td",{className:"action-buttons",children:[n.usuario&&e.jsx("button",{onClick:()=>d(n.id),className:"btn btn-yellow",children:"Desasignar"}),e.jsx("button",{onClick:()=>C(n.id),className:"btn btn-red",children:"Eliminar"})]})]},n.id)})})]})})]})]})},ee=()=>{const[t,S]=i.useState("dashboard"),N=q();z(_=>_.user);const I=z(_=>_.logout),T=async()=>{try{await I(),N("/")}catch(_){console.error("Error al cerrar sesi√≥n:",_)}},v={totalUsers:24,activeUsers:18,videosUploaded:12,turnos:{hoy:156,semana:873,mes:3542},tiempoPromedio:"4:35",tiempoEspera:"8:20"};return e.jsxs("div",{className:"admin-container",children:[e.jsxs("div",{className:"admin-sidebar",children:[e.jsx("div",{className:"admin-logo",children:e.jsx("h2",{children:"Kiosco Admin"})}),e.jsx("nav",{className:"admin-nav",children:e.jsxs("ul",{children:[e.jsx("li",{className:t==="dashboard"?"active":"",children:e.jsxs("button",{onClick:()=>S("dashboard"),children:[e.jsx("span",{className:"icon",children:"üìä"}),e.jsx("span",{children:"Dashboard"})]})}),e.jsx("li",{className:t==="users"?"active":"",children:e.jsxs("button",{onClick:()=>S("users"),children:[e.jsx("span",{className:"icon",children:"üë•"}),e.jsx("span",{children:"Usuarios"})]})}),e.jsx("li",{className:t==="videos"?"active":"",children:e.jsxs("button",{onClick:()=>S("videos"),children:[e.jsx("span",{className:"icon",children:"üé•"}),e.jsx("span",{children:"Videos"})]})}),e.jsx("li",{className:t==="reports"?"active":"",children:e.jsxs("button",{onClick:()=>S("reports"),children:[e.jsx("span",{className:"icon",children:"üìù"}),e.jsx("span",{children:"Reportes"})]})}),e.jsx("li",{className:t==="statistics"?"active":"",children:e.jsxs("button",{onClick:()=>S("statistics"),children:[e.jsx("span",{className:"icon",children:"üìà"}),e.jsx("span",{children:"Estad√≠sticas"})]})}),e.jsx("li",{className:t==="ventanillas"?"active":"",children:e.jsxs("button",{onClick:()=>S("ventanillas"),children:[e.jsx("span",{className:"icon",children:"üé´"}),e.jsx("span",{children:"Ventanillas"})]})})," "]})}),e.jsxs("div",{className:"admin-profile",children:[e.jsx("div",{className:"profile-avatar",children:e.jsx("span",{children:"üë§"})}),e.jsxs("div",{className:"profile-info",children:[e.jsx("h3",{children:"Admin Usuario"}),e.jsx("p",{children:"Administrador"}),e.jsxs("button",{onClick:T,className:"logout-button",children:[e.jsx(W,{}),e.jsx("span",{children:"Cerrar Sesi√≥n"})]})]})]})]}),e.jsxs("div",{className:"admin-content",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:se(t)}),e.jsxs("div",{className:"admin-actions",children:[e.jsxs("button",{className:"notification-btn",children:[e.jsx("span",{children:"üîî"}),e.jsx("span",{className:"notification-badge",children:"3"})]}),e.jsx("button",{className:"settings-btn",children:"‚öôÔ∏è"})]})]}),e.jsxs("div",{className:"admin-body",children:[t==="dashboard"&&e.jsx(Y,{data:v}),t==="users"&&e.jsx(K,{}),t==="videos"&&e.jsx(X,{}),t==="reports"&&e.jsx(Q,{}),t==="ventanillas"&&e.jsx(Z,{})]})]}),e.jsx(G,{})]})},se=t=>{switch(t){case"dashboard":return"Panel Principal";case"users":return"Gesti√≥n de Usuarios";case"videos":return"Carga de Videos";case"reports":return"Reportes";case"statistics":return"Estad√≠sticas";case"ventanillas":return"Gesti√≥n de Ventanillas";default:return"Panel de Administraci√≥n"}},oe=H(function(){return e.jsx(J,{allowedRoles:[1],children:e.jsx(ee,{})})});export{oe as default};
