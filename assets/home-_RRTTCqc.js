import{w as N,r as o,q as g}from"./chunk-NL6KNZEE-igR-ERF4.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{a as l}from"./client-DVUqMjJO.js";import{u as d,g as b}from"./authStore-Du5Ti9MW.js";import{F as y,a as A}from"./index-9DermFXF.js";const x=typeof window<"u";function K(){return[{title:"Sistema de Kiosko"},{name:"description",content:"Sistema de Kiosko para gestión de turnos"}]}const T=N(function(){const[u,j]=o.useState({username:"",password:""}),[m,n]=o.useState(null),f=b(),r=x?d(a=>a.user):f.user,c=x?d(a=>a.token):f.token,[v,h]=o.useState(!0),[i,S]=o.useState(!1);if(o.useEffect(()=>{console.log("Detectando cliente"),S(!0)},[]),o.useEffect(()=>{m&&i&&(window.location.href=m)},[m,i]),o.useEffect(()=>{i?(async()=>{const s=localStorage.getItem("token");if(s&&!c){console.log("Token encontrado en localStorage, verificando usuario...");try{l.defaults.headers.common.Authorization=`Bearer ${s}`;const t=await l.get("/api/user");t.status===200&&(d.getState().login({user:t.data,token:s}),console.log("Usuario verificado:",t.data),t.data.rol_id===1?(console.log("Usuario es administrador, redirigiendo a /admin"),n("/admin")):n("/ventanilla"))}catch(t){console.error("Error al verificar el token:",t),localStorage.removeItem("token"),delete l.defaults.headers.common.Authorization}}else r&&c&&(console.log("Usuario ya autenticado:",r),r.rol_id===1?n("/admin"):n("/ventanilla"));h(!1)})():h(!1)},[c,i,r]),v)return e.jsx("div",{children:"Cargando..."});if(r&&c)return null;const p=a=>{const{name:s,value:t}=a.target;j(w=>({...w,[s]:t}))},k=async a=>{if(a.preventDefault(),!!i)try{await l.get("/sanctum/csrf-cookie",{headers:{Accept:"application/json"}});const s=await l.post("api/login",{formData:u});d.getState().login(s.data),s.data.user.rol_id===1?n("/admin"):n("/ventanilla")}catch{alert("Error de autenticación")}};return e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"logo-container",children:e.jsx("h1",{className:"main-title",children:"Sistema de Kiosko"})}),e.jsxs("div",{className:"login-container",children:[e.jsx("div",{className:"card",children:e.jsxs("form",{onSubmit:k,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Usuario"}),e.jsx("input",{type:"text",id:"username",name:"username",value:u.username,onChange:p,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Contraseña"}),e.jsx("input",{type:"password",id:"password",name:"password",value:u.password,onChange:p,required:!0})]}),e.jsx("button",{type:"submit",className:"btn login-btn",children:"Ingresar"})]})}),e.jsxs("div",{className:"buttons-container",children:[e.jsxs(g,{to:"/promter",className:"nav-btn promter-btn",children:[e.jsx("span",{className:"icon",children:e.jsx(y,{size:20})}),e.jsx("span",{children:"Acceder al Promter"})]}),e.jsxs(g,{to:"/kiosko",className:"nav-btn kiosko-btn",children:[e.jsx("span",{className:"icon",children:e.jsx(A,{size:20})}),e.jsx("span",{children:"Acceder al Kiosko"})]})]})]}),e.jsx("footer",{className:"footer",children:e.jsxs("p",{children:["© ",new Date().getFullYear()," - Sistema de turnos"]})})]})});export{T as default,K as meta};
