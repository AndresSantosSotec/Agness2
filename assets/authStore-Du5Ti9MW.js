import{t as w}from"./chunk-NL6KNZEE-igR-ERF4.js";const H=r=>{let t;const e=new Set,s=(i,v)=>{const g=typeof i=="function"?i(t):i;if(!Object.is(g,t)){const S=t;t=v??(typeof g!="object"||g===null)?g:Object.assign({},t,g),e.forEach(m=>m(t,S))}},a=()=>t,c={setState:s,getState:a,getInitialState:()=>d,subscribe:i=>(e.add(i),()=>e.delete(i))},d=t=r(s,a,c);return c},j=r=>r?H(r):H,R=r=>r;function E(r,t=R){const e=w.useSyncExternalStore(r.subscribe,()=>t(r.getState()),()=>t(r.getInitialState()));return w.useDebugValue(e),e}const x=r=>{const t=j(r),e=s=>E(t,s);return Object.assign(e,t),e},F=r=>x;function J(r,t){let e;try{e=r()}catch{return}return{getItem:a=>{var o;const f=d=>d===null?null:JSON.parse(d,void 0),c=(o=e.getItem(a))!=null?o:null;return c instanceof Promise?c.then(f):f(c)},setItem:(a,o)=>e.setItem(a,JSON.stringify(o,void 0)),removeItem:a=>e.removeItem(a)}}const b=r=>t=>{try{const e=r(t);return e instanceof Promise?e:{then(s){return b(s)(e)},catch(s){return this}}}catch(e){return{then(s){return this},catch(s){return b(s)(e)}}}},N=(r,t)=>(e,s,a)=>{let o={storage:J(()=>localStorage),partialize:n=>n,version:0,merge:(n,h)=>({...h,...n}),...t},f=!1;const c=new Set,d=new Set;let i=o.storage;if(!i)return r((...n)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),e(...n)},s,a);const v=()=>{const n=o.partialize({...s()});return i.setItem(o.name,{state:n,version:o.version})},g=a.setState;a.setState=(n,h)=>{g(n,h),v()};const S=r((...n)=>{e(...n),v()},s,a);a.getInitialState=()=>S;let m;const k=()=>{var n,h;if(!i)return;f=!1,c.forEach(u=>{var l;return u((l=s())!=null?l:S)});const y=((h=o.onRehydrateStorage)==null?void 0:h.call(o,(n=s())!=null?n:S))||void 0;return b(i.getItem.bind(i))(o.name).then(u=>{if(u)if(typeof u.version=="number"&&u.version!==o.version){if(o.migrate){const l=o.migrate(u.state,u.version);return l instanceof Promise?l.then(p=>[!0,p]):[!0,l]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,u.state];return[!1,void 0]}).then(u=>{var l;const[p,O]=u;if(m=o.merge(O,(l=s())!=null?l:S),e(m,!0),p)return v()}).then(()=>{y==null||y(m,void 0),m=s(),f=!0,d.forEach(u=>u(m))}).catch(u=>{y==null||y(void 0,u)})};return a.persist={setOptions:n=>{o={...o,...n},n.storage&&(i=n.storage)},clearStorage:()=>{i==null||i.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>k(),hasHydrated:()=>f,onHydrate:n=>(c.add(n),()=>{c.delete(n)}),onFinishHydration:n=>(d.add(n),()=>{d.delete(n)})},o.skipHydration||k(),m||S},P=N,I=typeof window<"u",_={user:null,token:null},B=F()(P(r=>({..._,login:t=>{I&&localStorage.setItem("token",t.token),console.log("Guardando usuario en store:",t.user),r({user:t.user,token:t.token})},logout:()=>{I&&localStorage.removeItem("token"),r({user:null,token:null})}}),{name:"auth-storage",skipHydration:!I})),L=()=>_;export{L as g,B as u};
